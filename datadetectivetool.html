<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Data Detective â€” Anomaly Clue Game</title>
<style>
  :root{--bg:#f7f9fb;--card:#fff;--accent:#2952ff;--danger:#ff6347;--muted:#6b7280}
  body{font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:18px;color:#0f172a}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
  h1{font-size:20px;margin:0}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(12,16,32,0.06);margin-bottom:12px}
  input[type=file]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8;background:#fafcff}
  button{background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid #e6eef8;color:var(--accent)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .flex{display:flex;gap:8px;align-items:center}
  #previewTable{width:100%;border-collapse:collapse;margin-top:10px;display:block;overflow:auto}
  table th,table td{border:1px solid #eef2f7;padding:8px;white-space:nowrap}
  table th{background:#f3f7ff;position:sticky;top:0}
  .anomaly-row{background:linear-gradient(90deg, rgba(255,99,71,0.06), rgba(255,99,71,0.02))}
  .tag{display:inline-block;padding:6px 8px;border-radius:10px;background:#f1f5f9;color:#0f172a;font-size:13px}
  .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;margin-top:10px}
  .small{font-size:13px;color:var(--muted)}
  .clue-card{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef2f7;margin-bottom:8px}
  .score{font-weight:700;color:var(--accent)}
  .footer{display:flex;justify-content:space-between;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
  @media (max-width:520px){ header{flex-direction:column;align-items:flex-start} .controls{flex-direction:column} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>ðŸ”Ž Data Detective â€” Find the Clues</h1>
      <div class="small">Upload a CSV / Excel file. The tool finds anomalous rows as "clues". Click to investigate & score.</div>
    </div>
    <div class="flex">
      <div class="small">Score: <span id="score" class="score">0</span></div>
      <button id="resetBtn" class="btn-ghost">Reset Game</button>
    </div>
  </header>

  <section class="card">
    <label class="small">Upload CSV / Excel (.csv, .xlsx, .xls)</label>
    <input id="fileInput" type="file" accept=".csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" />
    <div class="controls">
      <button id="analyzeBtn">Analyze File</button>
      <button id="exportBtn" class="btn-ghost">Export Anomalies (CSV)</button>
      <select id="methodSelect" class="small">
        <option value="both">Detect: IQR + Z-score</option>
        <option value="iqr">IQR (boxplot) only</option>
        <option value="zscore">Z-score only</option>
      </select>
      <label class="small" style="align-self:center">Z cutoff:
        <input id="zcut" type="number" value="3" step="0.5" style="width:72px;margin-left:6px;padding:6px;border-radius:6px;border:1px solid #e6eef8" />
      </label>
    </div>

    <div id="summary" style="margin-top:12px" class="small"></div>
  </section>

  <section class="card" id="previewCard">
    <h3 style="margin:0 0 8px 0">Preview (first rows)</h3>
    <div id="preview"></div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px 0">Detected Clues (Anomalies)</h3>
    <div id="cluesList"></div>
    <div id="noClueMsg" class="small" style="display:none">No anomalies found. Try changing method or increase sensitivity.</div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px 0">Investigation Output</h3>
    <div id="investigation" class="small">Click a clue to reveal details and possible causes.</div>
  </section>

  <!-- New Button for Chat History -->
  <section class="card">
    <button id="chatHistoryBtn" class="btn-ghost" onclick="window.open('https://chatgpt.com/share/693141aa-baa0-8012-8763-1c1c1a559189', '_blank')">View Chat History</button>
  </section>

  <div class="footer">
    <div class="small">Tip: For Google Sheets export to CSV first (File â†’ Download â†’ CSV) then upload.</div>
    <div class="small">Built for mobile & desktop â€” offline</div>
  </div>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
// Add your existing JavaScript code here
</script>

</body>
</html>
